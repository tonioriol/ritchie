image:
  repository: ghcr.io/martinbjeldbak/acestream-http-proxy
  # Switch back to upstream latest (per request) to test whether newer builds
  # improve stream compatibility.
  tag: latest
  pullPolicy: Always

# Match the known-good legacy ritchie setup:
# - run privileged
# - persist engine state under /root/.ACEStream
# - do NOT pin AceStream engine version (let the image defaults decide)
acestream:
  stateDir: "/root/.ACEStream"
  privileged: true
  runAsUser: 0

# Persist AceStream state (recommended for stability across restarts).
# k3s typically provides the "local-path" StorageClass.
persistence:
  enabled: true
  # neumann uses Hetzner CSI; default StorageClass is `hcloud-volumes`.
  storageClassName: "hcloud-volumes"
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  # existingClaim: ""  # set to use a pre-created PVC

# CPU/memory tuning (helps reduce buffering caused by an under-provisioned engine).
resources:
  requests:
    cpu: "1000m"
    memory: "768Mi"
  limits:
    cpu: "2000m"
    memory: "2Gi"

# Deployment update strategy.
# The engine binds hostPorts (P2P ports). RollingUpdate with surge can't schedule a second pod,
# so we use Recreate to ensure hostPorts are freed before starting the new pod.
updateStrategy:
  type: Recreate

service:
  type: NodePort
  port: 6878
  nodePort: 30878

# AceStream benefits from inbound connectivity. Expose the engine's P2P/control
# ports on the node via hostPort (see templates/deployment.yaml).
#
# Observed on neumann (engine logs + /proc/net/tcp):
# - 8621: "LM" listen port
# - 62062: i2i (instance-to-instance) port
p2p:
  enabled: true
  port: 8621
  i2iPort: 62062

# Optional: provide a portless HTTPS endpoint (like the legacy ritchie nginx reverse-proxy)
# by running an in-cluster nginx reverse proxy + Traefik Ingress.
proxy:
  enabled: true

  resources:
    requests:
      cpu: "10m"
      memory: "32Mi"
    limits:
      cpu: "200m"
      memory: "256Mi"

ingress:
  # Traffic is served via Cloudflare Tunnel (no public Ingress required).
  enabled: false
  host: ace.tonioriol.com
  tls:
    enabled: true
    issuer: letsencrypt-prod
    secretName: ace-tonioriol-com-tls
